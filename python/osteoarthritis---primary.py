# Kuan V, Denaxas S, Gonzalez-Izquierdo A, Direk K, Bhatti O, Husain S, Sutaria S, Hingorani M, Nitsch D, Parisinos C, Lumbers T, Mathur R, Sofat R, Casas JP, Wong I, Hemingway H, Hingorani A, 2024.

import sys, csv, re

codes = [{"code":"N05..11","system":"readv2"},{"code":"14G2.00","system":"readv2"},{"code":"106678.0","system":"readv2"},{"code":"73952.0","system":"readv2"},{"code":"54350.0","system":"readv2"},{"code":"42045.0","system":"readv2"},{"code":"5802.0","system":"readv2"},{"code":"44041.0","system":"readv2"},{"code":"4015.0","system":"readv2"},{"code":"24958.0","system":"readv2"},{"code":"25812.0","system":"readv2"},{"code":"43474.0","system":"readv2"},{"code":"19713.0","system":"readv2"},{"code":"23676.0","system":"readv2"},{"code":"658.0","system":"readv2"},{"code":"34035.0","system":"readv2"},{"code":"51360.0","system":"readv2"},{"code":"40972.0","system":"readv2"},{"code":"8202.0","system":"readv2"},{"code":"34804.0","system":"readv2"},{"code":"9010.0","system":"readv2"},{"code":"4967.0","system":"readv2"},{"code":"27834.0","system":"readv2"},{"code":"32891.0","system":"readv2"},{"code":"49545.0","system":"readv2"},{"code":"4461.0","system":"readv2"},{"code":"9649.0","system":"readv2"},{"code":"73948.0","system":"readv2"},{"code":"59616.0","system":"readv2"},{"code":"52095.0","system":"readv2"},{"code":"1509.0","system":"readv2"},{"code":"3057.0","system":"readv2"},{"code":"57912.0","system":"readv2"},{"code":"17282.0","system":"readv2"},{"code":"106205.0","system":"readv2"},{"code":"20626.0","system":"readv2"},{"code":"45815.0","system":"readv2"},{"code":"2229.0","system":"readv2"},{"code":"11256.0","system":"readv2"},{"code":"4878.0","system":"readv2"},{"code":"16242.0","system":"readv2"},{"code":"18112.0","system":"readv2"},{"code":"32839.0","system":"readv2"},{"code":"1296.0","system":"readv2"},{"code":"53741.0","system":"readv2"},{"code":"665.0","system":"readv2"},{"code":"24022.0","system":"readv2"},{"code":"35919.0","system":"readv2"},{"code":"33574.0","system":"readv2"},{"code":"2209.0","system":"readv2"},{"code":"24217.0","system":"readv2"},{"code":"99918.0","system":"readv2"},{"code":"18795.0","system":"readv2"},{"code":"5776.0","system":"readv2"},{"code":"24326.0","system":"readv2"},{"code":"31200.0","system":"readv2"},{"code":"41088.0","system":"readv2"},{"code":"11032.0","system":"readv2"},{"code":"24079.0","system":"readv2"},{"code":"35527.0","system":"readv2"},{"code":"23646.0","system":"readv2"},{"code":"15441.0","system":"readv2"},{"code":"34023.0","system":"readv2"},{"code":"65748.0","system":"readv2"},{"code":"52897.0","system":"readv2"},{"code":"38019.0","system":"readv2"},{"code":"3147.0","system":"readv2"},{"code":"28908.0","system":"readv2"},{"code":"21350.0","system":"readv2"},{"code":"20472.0","system":"readv2"},{"code":"36182.0","system":"readv2"},{"code":"70425.0","system":"readv2"},{"code":"57267.0","system":"readv2"},{"code":"18602.0","system":"readv2"},{"code":"4490.0","system":"readv2"},{"code":"7866.0","system":"readv2"},{"code":"101479.0","system":"readv2"},{"code":"68712.0","system":"readv2"},{"code":"6887.0","system":"readv2"},{"code":"15144.0","system":"readv2"},{"code":"97073.0","system":"readv2"},{"code":"24432.0","system":"readv2"},{"code":"25793.0","system":"readv2"},{"code":"41985.0","system":"readv2"},{"code":"1312.0","system":"readv2"},{"code":"9681.0","system":"readv2"},{"code":"3814.0","system":"readv2"},{"code":"53858.0","system":"readv2"},{"code":"59637.0","system":"readv2"},{"code":"24145.0","system":"readv2"},{"code":"36327.0","system":"readv2"},{"code":"23638.0","system":"readv2"},{"code":"34867.0","system":"readv2"},{"code":"15839.0","system":"readv2"},{"code":"34806.0","system":"readv2"},{"code":"38018.0","system":"readv2"},{"code":"41090.0","system":"readv2"},{"code":"68648.0","system":"readv2"},{"code":"48214.0","system":"readv2"},{"code":"21177.0","system":"readv2"},{"code":"15447.0","system":"readv2"},{"code":"1959.0","system":"readv2"},{"code":"54224.0","system":"readv2"},{"code":"10854.0","system":"readv2"},{"code":"27972.0","system":"readv2"},{"code":"33479.0","system":"readv2"},{"code":"60537.0","system":"readv2"},{"code":"24287.0","system":"readv2"},{"code":"73930.0","system":"readv2"},{"code":"21159.0","system":"readv2"},{"code":"21528.0","system":"readv2"},{"code":"72109.0","system":"readv2"},{"code":"4353.0","system":"readv2"},{"code":"396.0","system":"readv2"},{"code":"38631.0","system":"readv2"},{"code":"24146.0","system":"readv2"},{"code":"102990.0","system":"readv2"},{"code":"2487.0","system":"readv2"},{"code":"15052.0","system":"readv2"},{"code":"20660.0","system":"readv2"},{"code":"6812.0","system":"readv2"},{"code":"55388.0","system":"readv2"},{"code":"1104.0","system":"readv2"},{"code":"34122.0","system":"readv2"}];
REQUIRED_CODES = 1;
with open(sys.argv[1], 'r') as file_in, open('osteoarthritis-potential-cases.csv', 'w', newline='') as file_out:
    csv_reader = csv.DictReader(file_in)
    csv_writer = csv.DictWriter(file_out, csv_reader.fieldnames + ["osteoarthritis---primary-identified"])
    csv_writer.writeheader();
    codes_identified = 0;
    for row in csv_reader:
        newRow = row.copy();
        for cell in row:
            # Iterate cell lists (e.g. codes)
            for item in re.findall(r'\(([^,]*)\,', row[cell]):
                if(item in list(map(lambda code: code['code'], codes))): codes_identified+=1;
                if(codes_identified>=REQUIRED_CODES):
                    newRow["osteoarthritis---primary-identified"] = "CASE";
                    break;
            if(codes_identified>=REQUIRED_CODES): break;
        if(codes_identified<REQUIRED_CODES):
            newRow["osteoarthritis---primary-identified"] = "UNK";
        codes_identified=0;
        csv_writer.writerow(newRow)
